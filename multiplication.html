<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multiplication Practice</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h1>Multiplication Practice</h1>
    <div id="setup">
        <label>Number of Questions: 
            <input type="number" id="totalQuestions" min="1" max="100" value="10">
        </label>
        <button onclick="startPractice()">Start</button>
    </div>

    <div id="quiz" style="display:none;">
        <div id="question" class="big-question"></div>
        <input type="number" id="answer" autocomplete="off">
        <button id="submitBtn">Submit</button>
    </div>

    <div id="results" style="display:none;">
        <h2>Results</h2>
        <p id="stats"></p>
        <table border="1" id="resultsTable">
            <tr>
                <th>Q No</th>
                <th>Question</th>
                <th>Correct Answer</th>
                <th>Your Answer</th>
                <th>Time (s)</th>
                <th>Result</th>
            </tr>
        </table>
        <button onclick="restart()">Restart</button>
        <button onclick="downloadCSV()">Download CSV</button>
    </div>
</div>

<script>
let totalQuestions, currentQuestion = 0, startTime, questionStartTime;
let results = [];

function startPractice() {
    totalQuestions = parseInt(document.getElementById("totalQuestions").value);
    currentQuestion = 0;
    results = [];
    document.getElementById("setup").style.display = "none";
    document.getElementById("quiz").style.display = "block";
    nextQuestion();
}

function nextQuestion() {
    if (currentQuestion >= totalQuestions) {
        endPractice();
        return;
    }
    let num1 = Math.floor(Math.random() * (25 - 2 + 1)) + 2;
    let num2 = Math.floor(Math.random() * (9 - 2 + 1)) + 2;
    let questionText = `Q${currentQuestion + 1}: ${num1} × ${num2}`;
    document.getElementById("question").textContent = questionText;
    document.getElementById("answer").value = "";
    document.getElementById("answer").focus();
    startTime = Date.now();
    questionStartTime = {num1, num2};
}

function submitAnswer() {
    let answer = parseInt(document.getElementById("answer").value);
    if (isNaN(answer)) return;
    let timeTaken = (Date.now() - startTime) / 1000;
    let correctAnswer = questionStartTime.num1 * questionStartTime.num2;
    results.push({
        question: `${questionStartTime.num1} × ${questionStartTime.num2}`,
        correctAnswer,
        userAnswer: answer,
        time: timeTaken
    });
    currentQuestion++;
    nextQuestion();
}

function endPractice() {
    document.getElementById("quiz").style.display = "none";
    document.getElementById("results").style.display = "block";

    let times = results.map(r => r.time);
    let totalTime = times.reduce((a,b) => a+b, 0);
    let avgTime = totalTime / times.length;
    let minTime = Math.min(...times);
    let maxTime = Math.max(...times);
    let minQ = results[times.indexOf(minTime)].question;
    let maxQ = results[times.indexOf(maxTime)].question;

    document.getElementById("stats").innerHTML = `
        Total Time: ${totalTime.toFixed(2)}s<br>
        Average Time: ${avgTime.toFixed(2)}s<br>
        Fastest: ${minTime.toFixed(2)}s on ${minQ}<br>
        Slowest: ${maxTime.toFixed(2)}s on ${maxQ}
    `;

    let table = document.getElementById("resultsTable");
    results.forEach((res, i) => {
        let row = document.createElement("tr");
        row.innerHTML = `
            <td>${i + 1}</td>
            <td>${res.question}</td>
            <td>${res.correctAnswer}</td>
            <td>${res.userAnswer}</td>
            <td>${res.time.toFixed(2)}</td>
            <td>${res.userAnswer === res.correctAnswer ? "✅" : "❌"}</td>
        `;
        table.appendChild(row);
    });
}

function restart() {
    location.reload();
}

function downloadCSV() {
    let csvContent = "data:text/csv;charset=utf-8," +
        "Q No,Question,Correct Answer,Your Answer,Time (s),Result\n";
    results.forEach((res, i) => {
        csvContent += `${i + 1},${res.question},${res.correctAnswer},${res.userAnswer},${res.time.toFixed(2)},${res.userAnswer === res.correctAnswer ? "Correct" : "Wrong"}\n`;
    });
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "multiplication_results.csv");
    document.body.appendChild(link);
    link.click();
}

document.getElementById("submitBtn").addEventListener("click", submitAnswer);
document.getElementById("answer").addEventListener("keypress", function(e) {
    if (e.key === "Enter") submitAnswer();
});
</script>
</body>
</html>
