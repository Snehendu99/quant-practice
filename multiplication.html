<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multiplication Practice</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Multiplication Practice</h1>

        <div id="start-screen">
            <label for="numQuestions">Number of Questions:</label>
            <input type="number" id="numQuestions" min="1" max="50" value="10">
            <button id="startBtn">Start</button>
        </div>

        <div id="quiz-screen" style="display:none;">
            <div id="question-container">
                <span id="question-number"></span>. 
                <span id="question-text"></span>
            </div>
            <input type="number" id="answer" placeholder="Your answer" autocomplete="off">
            <button id="submitBtn">Submit</button>
            <div id="timer">Time: 0.00s</div>
        </div>

        <div id="result-screen" style="display:none;">
            <h2>Results</h2>
            <div id="stats"></div>
            <div id="question-list"></div>
            <button id="downloadBtn">Download CSV</button>
            <button id="restartBtn">Restart</button>
        </div>
    </div>

<script>
let totalQuestions = 10;
let currentQuestion = 0;
let questions = [];
let startTime, questionStartTime;

document.getElementById("startBtn").addEventListener("click", startQuiz);
document.getElementById("submitBtn").addEventListener("click", submitAnswer);
document.getElementById("answer").addEventListener("keydown", e => {
    if (e.key === "Enter") submitAnswer();
});
document.getElementById("downloadBtn").addEventListener("click", downloadCSV);
document.getElementById("restartBtn").addEventListener("click", () => location.reload());

function startQuiz() {
    totalQuestions = parseInt(document.getElementById("numQuestions").value) || 10;
    questions = [];
    currentQuestion = 0;
    document.getElementById("start-screen").style.display = "none";
    document.getElementById("quiz-screen").style.display = "block";
    startTime = Date.now();
    nextQuestion();
}

function nextQuestion() {
    if (currentQuestion >= totalQuestions) {
        endQuiz();
        return;
    }
    const num1 = Math.floor(Math.random() * (25 - 2 + 1)) + 2;
    const num2 = Math.floor(Math.random() * (9 - 2 + 1)) + 2;

    document.getElementById("question-number").textContent = currentQuestion + 1;
    document.getElementById("question-text").textContent = `${num1} × ${num2}`;
    document.getElementById("answer").value = "";
    document.getElementById("answer").focus();

    questionStartTime = Date.now();
    document.getElementById("timer").textContent = "Time: 0.00s";
    updateTimer();
}

function updateTimer() {
    if (currentQuestion >= totalQuestions) return;
    const elapsed = (Date.now() - questionStartTime) / 1000;
    document.getElementById("timer").textContent = `Time: ${elapsed.toFixed(2)}s`;
    requestAnimationFrame(updateTimer);
}

function submitAnswer() {
    const answerInput = document.getElementById("answer");
    const answer = parseInt(answerInput.value);
    if (isNaN(answer)) return;

    const questionText = document.getElementById("question-text").textContent;
    const [num1, num2] = questionText.split(" × ").map(Number);
    const correctAnswer = num1 * num2;
    const timeTaken = ((Date.now() - questionStartTime) / 1000).toFixed(2);

    questions.push({
        questionNumber: currentQuestion + 1,
        num1, num2,
        userAnswer: answer,
        correctAnswer,
        timeTaken
    });

    currentQuestion++;
    nextQuestion();
}

function endQuiz() {
    document.getElementById("quiz-screen").style.display = "none";
    document.getElementById("result-screen").style.display = "block";

    const totalTime = ((Date.now() - startTime) / 1000).toFixed(2);
    const times = questions.map(q => parseFloat(q.timeTaken));
    const maxTime = Math.max(...times);
    const minTime = Math.min(...times);
    const avgTime = (times.reduce((a, b) => a + b, 0) / times.length).toFixed(2);
    const maxQ = questions[times.indexOf(maxTime)].questionNumber;
    const minQ = questions[times.indexOf(minTime)].questionNumber;

    let statsHtml = `
        <p>Total Time: ${totalTime}s</p>
        <p>Max Time: ${maxTime}s (Q${maxQ})</p>
        <p>Min Time: ${minTime}s (Q${minQ})</p>
        <p>Average Time: ${avgTime}s</p>
    `;
    document.getElementById("stats").innerHTML = statsHtml;

    let listHtml = "<table><tr><th>#</th><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Time (s)</th></tr>";
    questions.forEach(q => {
        const correct = q.userAnswer === q.correctAnswer;
        listHtml += `<tr class="${correct ? 'correct' : 'wrong'}">
            <td>${q.questionNumber}</td>
            <td>${q.num1} × ${q.num2}</td>
            <td>${q.userAnswer}</td>
            <td>${q.correctAnswer}</td>
            <td>${q.timeTaken}</td>
        </tr>`;
    });
    listHtml += "</table>";
    document.getElementById("question-list").innerHTML = listHtml;
}

function downloadCSV() {
    const rows = [["SL NO","Question","Your Answer","Correct Answer","Time (s)"]];
    questions.forEach(q => {
        rows.push([
            q.questionNumber,
            `${q.num1} × ${q.num2}`,
            q.userAnswer,
            q.correctAnswer,
            q.timeTaken
        ]);
    });
    const escapeCSV = v => {
        const s = String(v ?? "");
        return /[",\r\n]/.test(s) ? `"${s.replace(/"/g,'""')}"` : s;
    };
    const csvString = rows.map(r => r.map(escapeCSV).join(",")).join("\r\n");
    const blob = new Blob(["\uFEFF" + csvString], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `multiplication_results_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
